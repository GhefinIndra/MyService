<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyService Login</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Tambahkan gaya untuk peta */
        #map {
            width: 100%;
            height: 600px;
            margin: 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>MyService</h1>
        <p>Solusi Terpercaya untuk Perbaikan Smartphone Anda</p>
        <div class="hamburger-menu" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>        
    </header>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="profile-picture"></div>
            <p id="userName">namehere</p>
            <small id="userEmail">emailhere</small>
        </div>
        <ul class="sidebar-menu">
            <li><button onclick="navigateToProfile()">My Profile</button></li>
            <li><button>History</button></li>
            <li><button>Contact Us</button></li>
        </ul>
    </div>

    <nav>
        <ul>
            <li><a href="beranda.html">Beranda</a></li>
            <li><a href="layanan.html">Layanan</a></li>
            <li><a href="panduan.html">Panduan</a></li>
        </ul>
    </nav>

    <!-- Tambahkan elemen untuk peta -->
    <div id="map"></div>

    <footer>
        <p>Â© 2024 MyService - Spesialis Perbaikan Smartphone</p>
        <p>Alamat: Pesona Bali Residence, Bl. B12 No.17, Bojongsoang, Bandung Regency, West Java 40288</p>
        <p>Telepon: 0812-2512-2418 | Email: ganesha.irza@gmail.com</p>
    </footer>

    <script>
        const userId = localStorage.getItem('user_id');

        if (userId) {   
            fetch(`http://localhost:3000/getUserData/${userId}`)
            .then(response => response.json())
            .then(data => {
                if (data.name && data.email) {
                    document.querySelector('#userName').textContent = data.name;
                    document.querySelector('#userEmail').textContent = data.email;
                } else {
                    console.log('User data not available');
                }
            })
            .catch(error => {
                console.error('Error fetching user data:', error);
            });
        } else {
            console.log('No user_id found');
        }

        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.style.display = sidebar.style.display === 'none' ? 'block' : 'none';
        }

        function navigateToProfile() {
            window.location.href = 'profile.html';
        }

    function initMap() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                position => {
                    const userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    // Buat peta di lokasi pengguna
                    const map = new google.maps.Map(document.getElementById("map"), {
                        center: userLocation,
                        zoom: 15
                    });

                    // Tambahkan marker untuk lokasi pengguna dengan ikon kustom
                    new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: "Lokasi Anda",
                        icon: {
                            url: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png" // Ikon biru untuk lokasi pengguna
                        }
                    });

                    // Cari lokasi service HP di sekitar
                    const service = new google.maps.places.PlacesService(map);
                    service.nearbySearch(
                        {
                            location: userLocation,
                            radius: 5000, // Radius pencarian dalam meter
                            keyword: "service hp" // Kata kunci pencarian
                        },
                        (results, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK) {
                                results.forEach(place => {
                                    // Tambahkan marker untuk toko service HP dengan ikon kustom
                                    const marker = new google.maps.Marker({
                                        position: place.geometry.location,
                                        map: map,
                                        title: place.name,
                                        icon: {
                                            url: "https://maps.google.com/mapfiles/ms/icons/red-dot.png" // Ikon merah untuk toko service HP
                                        }
                                    });

                                    // Buat InfoWindow untuk menampilkan informasi toko
                                    const rating = place.rating ? `${place.rating} / 5` : "Belum ada rating";
                                    const infoWindow = new google.maps.InfoWindow({
                                        content: `
                                            <strong>${place.name}</strong><br>
                                            ${place.vicinity}<br>
                                            <strong>Rating:</strong> ${rating}
                                        `
                                    });

                                    // Tambahkan event listener untuk menampilkan InfoWindow saat di-hover
                                    marker.addListener("mouseover", () => {
                                        infoWindow.open(map, marker);
                                    });

                                    // Tambahkan event listener untuk menutup InfoWindow saat cursor keluar
                                    marker.addListener("mouseout", () => {
                                        infoWindow.close();
                                    });
                                });
                            } else {
                                console.error("Pencarian gagal:", status);
                            }
                        }
                    );
                },
                error => {
                    console.error("Geolocation gagal:", error);
                }
            );
        } else {
            alert("Geolocation tidak didukung oleh browser Anda.");
        }
    }
</script>




    <!-- Tambahkan skrip API Google Maps -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCG8OUtHwvXT_F1kxoY1ByaNWFOysaZ3fU&libraries=places&callback=initMap" async defer></script>
</body>
</html>
